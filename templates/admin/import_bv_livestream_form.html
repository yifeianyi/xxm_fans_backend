{% extends "admin/base_site.html" %}
{% block content %}
<h1>导入直播记录BV号</h1>
<form method="post" style="max-width: 400px;">{% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="default">导入</button>
</form>
<a href="{% url 'admin:livestream_livestream_changelist' %}">← 返回直播记录列表</a>

<!-- 
    使用说明:
-->
<div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px;">
    <h3>📋 使用说明：</h3>
    <ul>
        <li><strong>BV号获取</strong>：从B站视频URL中获取，例如：<code>BV1xx411c7mD</code></li>
        <li><strong>视频标题格式要求</strong>：分P标题必须符合以下格式之一：
            <ul>
                <li><code>主播名-YYYY-MM-DD-标题内容</code>（例如：<code>咻咻满-2019-12-10-直播录像-户外专场</code>）</li>
                <li><code>主播名-YYYY年M月D日-标题内容</code>（例如：<code>咻咻满-2019年12月10日-直播录像</code>）</li>
                <li>系统会自动解析日期和直播标题</li>
                <li>不符合此格式的分P将被跳过</li>
            </ul>
        </li>
        <li><strong>自动获取信息</strong>：系统会自动获取视频的封面、分P信息、直播时长等</li>
        <li><strong>标题与简介分离</strong>：
            <ul>
                <li>系统会识别标题中的"直播录像"关键字</li>
                <li>标题保留到"直播录像"为止（包含主播名和日期）</li>
                <li>"直播录像"之后的部分作为直播简介（不含日期）</li>
                <li>例如：<code>咻咻满-2019-12-10-直播录像-户外专场</code> → 标题"咻咻满-2019-12-10-直播录像"，简介"户外专场"</li>
            </ul>
        </li>
        <li><strong>封面处理</strong>：
            <ul>
                <li>使用视频总封面作为直播封面</li>
                <li>封面保存路径：<code>/media/covers/{year}/{month}/</code></li>
                <li>封面文件格式：<code>YYYY-MM-DD.jpg</code></li>
            </ul>
        </li>
        <li><strong>多分P处理</strong>：
            <ul>
                <li>无论视频包含多少分P，只创建一条直播记录</li>
                <li>系统会从第一个分P的标题中提取日期和直播标题</li>
                <li>总分P数会记录在"视频分段数"字段中</li>
                <li>前端会根据分段数生成对应的播放链接</li>
            </ul>
        </li>
    </ul>

    <h3 style="color: #d9534f;">⚠️ 重点提示：</h3>
    <ul>
        <li><strong>重复记录处理（按日期判断）</strong>：
            <ul>
                <li><strong>不会重复创建</strong>：系统根据直播日期判断记录是否已存在</li>
                <li><strong>自动补充BV号</strong>：如果该日期记录已存在但没有BV号，导入时会自动补充BV号、直播时长和分段数</li>
                <li><strong>已有BV号的记录</strong>：如果记录已有BV号，导入时只会更新标题、封面等信息，不会覆盖原有BV号</li>
            </ul>
        </li>
        <li><strong>封面选择功能</strong>：
            <ul>
                <li>如果该日期已有封面，系统会显示<strong>封面选择页面</strong></li>
                <li>左侧显示<strong>现有封面</strong>缩略图，右侧显示<strong>待下载新封面</strong>预览</li>
                <li>您可以选择<strong>保留现有封面</strong>或<strong>使用新封面</strong></li>
                <li>无论选择哪种封面，其他信息（标题、BV号、时长等）都会正常更新</li>
            </ul>
        </li>
        <li><strong>单记录原则</strong>：每个BV号只创建一条直播记录，多P视频的分段数记录在"视频分段数"字段中</li>
        <li><strong>标题来源</strong>：多P视频的标题取自第一个分P的标题（去除日期部分）</li>
        <li><strong>直播时长</strong>：自动从B站API获取总时长，格式化为如"3h4m50s"的形式</li>
        <li><strong>视频分段数</strong>：导入时会记录视频的总分P数，用于前端生成播放链接</li>
    </ul>

    <h3 style="color: #5bc0de;">💡 使用示例：</h3>
    <div style="background: #fff; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 13px;">
        <strong>视频URL</strong>：<code>https://www.bilibili.com/video/BV1234567890</code><br><br>
        
        <strong>示例1 - 标题与简介分离</strong>：<br>
        视频标题：<code>咻咻满-2019-12-10-直播录像-户外专场，全程高能！！！</code><br>
        解析结果：<br>
        &nbsp;&nbsp;• 日期：2019-12-10<br>
        &nbsp;&nbsp;• 标题：咻咻满-2019-12-10-直播录像（包含日期）<br>
        &nbsp;&nbsp;• 简介：户外专场，全程高能！！！（不含日期）<br>
        &nbsp;&nbsp;• 分段数：1<br><br>
        
        <strong>示例2 - 无简介</strong>：<br>
        视频标题：<code>咻咻满-2019-12-10-直播录像</code><br>
        解析结果：<br>
        &nbsp;&nbsp;• 日期：2019-12-10<br>
        &nbsp;&nbsp;• 标题：咻咻满-2019-12-10-直播录像<br>
        &nbsp;&nbsp;• 简介：2019-12-10 的精彩直播时刻（默认）<br><br>
        
        <strong>示例3 - 多P视频</strong>：<br>
        分P标题：<br>
        &nbsp;&nbsp;P1: <code>咻咻满-2019-12-10-直播录像-上半场</code><br>
        &nbsp;&nbsp;P2: <code>咻咻满-2019-12-10-直播录像-下半场</code><br>
        解析结果：<br>
        &nbsp;&nbsp;• 创建一条直播记录（取P1信息）<br>
        &nbsp;&nbsp;• 日期：2019-12-10<br>
        &nbsp;&nbsp;• 标题：咻咻满-2019-12-10-直播录像<br>
        &nbsp;&nbsp;• 简介：上半场<br>
        &nbsp;&nbsp;• 分段数：2
    </div>
</div>
</div>
{% endblock %}
