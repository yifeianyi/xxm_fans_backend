{% extends "admin/base_site.html" %}
{% load i18n admin_urls static admin_modify %}

{% block extrahead %}{{ block.super }}
<script type="text/javascript" src="{% url 'admin:jsi18n' %}"></script>
{{ form.media }}
{% endblock %}

{% block extrastyle %}{{ block.super }}
<link rel="stylesheet" type="text/css" href="{% static " admin/css/forms.css" %}">
{% endblock %}

{% block coltype %}colM{% endblock %}

{% block bodyclass %}{{ block.super }} app-{{ opts.app_label }} model-{{ opts.model_name }} change-form{% endblock %}

{% block breadcrumbs %}
<div class="breadcrumbs">
    <a href="{% url 'admin:index' %}">{% trans 'Home' %}</a>
    &rsaquo; <span>æ­Œæ›²ç®¡ç†</span>
    &rsaquo; <a href="{% url 'admin:song_management_songrecord_changelist' %}">æ¼”å”±è®°å½•</a>
    &rsaquo; BVå¯¼å…¥ - é€‰æ‹©æ­Œæ›²
</div>
{% endblock %}

{% block content %}
<div id="content-main">
    <div class="module aligned">
        <h2>ğŸµ å‘ç°åŒåæ­Œæ›²ï¼Œè¯·é€‰æ‹©è¦å…³è”çš„æ­Œæ›²</h2>

        <div class="description">
            <p><strong>æ­Œæ›²åç§°ï¼š</strong>{{ song_name }}</p>
            {% if current_part %}
            <p><strong>å½“å‰åˆ†Pï¼š</strong>{{ current_part.title }}</p>
            <p><strong>æ¼”å”±æ—¥æœŸï¼š</strong>{{ current_part.performed_date }}</p>
            {% endif %}
        </div>

        <form method="post" action="{% url 'admin:import-bv-songrecord' %}">
            {% csrf_token %}
            <input type="hidden" name="bvid" value="{{ bvid }}">
            <input type="hidden" name="pending_parts" value="{{ pending_parts }}">
            <input type="hidden" name="all_results_count" value="{{ all_results_count|default:0 }}">

            <fieldset class="module aligned">
                <div class="form-row">
                    <label>é€‰æ‹©æ­Œæ›²ï¼š</label>
                    <div class="radio-group">
                        {% for song in candidates %}
                        <div class="radio-item">
                            <input type="radio" name="selected_song_id" value="{{ song.id }}" id="song_{{ song.id }}"
                                required>
                            <label for="song_{{ song.id }}">
                                <strong>{{ song.song_name }}</strong>
                                {% if song.singer %}<span class="singer">åŸå”±: {{ song.singer }}</span>{% endif %}
                                {% if song.language %}<span class="language">[{{ song.language }}]</span>{% endif %}
                                <span class="stats">- æ¼”å”±æ¬¡æ•°: {{ song.perform_count }}</span>
                            </label>
                        </div>
                        {% endfor %}
                        
                        <div class="radio-item new-song-option">
                            <input type="radio" name="selected_song_id" value="__new__" id="song_new" required>
                            <label for="song_new">
                                <strong>ğŸ†• åˆ›å»ºä¸ºæ–°æ­Œæ›²</strong>
                                <span class="hint">ï¼ˆå¦‚æœä»¥ä¸Šéƒ½ä¸æ˜¯æ‚¨è¦å¯¼å…¥çš„æ­Œæ›²ï¼Œé€‰æ‹©æ­¤é¡¹åˆ›å»ºæ–°æ¡ç›®ï¼‰</span>
                            </label>
                        </div>
                    </div>
                </div>
            </fieldset>

            <div class="submit-row">
                <input type="submit" value="ç¡®è®¤é€‰æ‹©å¹¶ç»§ç»­å¯¼å…¥" class="default" name="_save">
                <a href="{% url 'admin:song_management_songrecord_changelist' %}" class="button cancel-link">å–æ¶ˆ</a>
            </div>
        </form>
    </div>
</div>

<style>
    .radio-group {
        margin: 10px 0;
    }

    .radio-item {
        margin: 10px 0;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        background: #f9f9f9;
    }

    .radio-item:hover {
        background: #f0f0f0;
    }

    .radio-item input[type="radio"] {
        margin-right: 10px;
    }

    .radio-item label {
        font-weight: normal;
        cursor: pointer;
    }

    .description {
        background: #fff3cd;
        border: 1px solid #ffeaa7;
        border-radius: 5px;
        padding: 15px;
        margin: 15px 0;
    }

    .singer {
        color: #e74c3c;
        font-weight: bold;
        margin-left: 8px;
    }

    .language {
        color: #3498db;
        margin-left: 5px;
    }

    .stats {
        color: #7f8c8d;
        margin-left: 10px;
    }

    .new-song-option {
        background: #e8f6f3;
        border: 2px solid #1abc9c;
    }

    .new-song-option:hover {
        background: #d1f2eb;
    }

    .hint {
        color: #7f8c8d;
        font-size: 0.9em;
        margin-left: 10px;
    }
</style>
{% endblock %}